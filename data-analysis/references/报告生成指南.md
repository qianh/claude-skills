# 数据分析报告生成指南

本文档旨在规范 `data-analysis` 技能在生成不同格式报告（Markdown/PDF/DOCX）时的标准流程与注意事项，确保交付结果的专业性与一致性。

## 1. 通用核心标准
无论生成何种格式，所有报告必须严格遵守以下数据与内容标准：

* **数据完整性**：
    * 所有引用的 KPI 指标必须经过非空检查。
    * 统计结果需保留合理的小数位（如金额保留2位，百分比保留2位），避免直接输出原始高精度浮点数。
* **可视化规范**：
    * **位置合法**：图表插入的位置要合适，不能与文字重叠，图表的上下侧与文字最多有一行的空隙。
    * **缩放合理**：图表插入时要进行合理的缩放，太大会影响页面布局，太小不方便阅读。一张图片的高度尽量不超过页面的50%。
    * **解释性**：图表下方必须紧跟一段简短的“图表解读”，指出数据的核心趋势或异常点。
* **叙事逻辑**：
    * 遵循 `数据 -> 问题 -> 原因 -> 建议` 的闭环逻辑。

## 2. 格式专项指南

### 2.1 Markdown 报告 (.md) —— 默认与轻量交付

Markdown 是智能体与用户交互的首选格式，强调信息的快速传递与代码的可读性。用户无指定格式时首选markdown。

* **适用场景**：快速问答、探索性分析结果 (EDA)、技术复盘、执行摘要。
* **结构设计**：
    * **一级标题 (#)**：报告名称（例如：`# 2023年Q3销售数据分析报告`）。
    * **二级标题 (##)**：核心章节（`## 1. 核心结论`、`## 2. 数据概览`、`## 3. 详细分析`）。
    * **三级标题 (###)**：具体指标或图表板块。
* **表格处理**：
    * 严禁直接打印原始 DataFrame。必须使用 `df.to_markdown()` 或 `tabulate` 库生成对齐良好的 Markdown 表格。
    * 对于超过 10 行的数据，仅展示 `head(5)` 或聚合后的统计表，并提示“完整数据请见附件 CSV”。
* **图表集成**：
    * **语法**：使用标准语法 `![图表说明](./output/chart_name.png)`。
    * **约束**：确保引用的图片路径是相对路径，且图片已实际保存至工作空间。

### 2.2 PDF 报告 (.pdf) —— 正式存档与打印

PDF 格式用于向管理层汇报或外部交付，要求版面固定、格式严谨。

* **适用场景**：商业洞察报告、月度/季度经营分析、对外发布的行业报告。
* **工程实现**：
    * **工具推荐**：建议优先生成 Markdown 或 HTML 中间层，再使用转换工具（如 `WeasyPrint` 或 `Pandoc`）导出为 PDF，以确保样式可控；或使用 Python 的 `ReportLab` 库进行像素级控制。可参考`/pdf`工具。
* **排版与布局**：
    * **封面页**：必须包含报告标题、生成日期。
    * **分页控制**：避免将一张图表或一个表格切分在两页显示。重要章节（如“核心结论”）应强制换页开始。
    * **页眉页脚**：添加页码（如 "Page 1 of 5"）。
* **视觉一致性**：
    * 图表背景色应设为白色或透明，避免与 PDF 页面背景冲突。
    * 字体应选用支持中文显示的通用字体（如 SimHei, Arial Unicode MS），防止乱码。

### 2.3 Word 报告 (.docx) —— 可编辑与协作

DOCX 格式用于需要用户二次编辑、修订或合并到更大文档中的场景。

* **适用场景**：草稿型分析报告、需要人工润色的深度分析文档。
* **工程实现**：
    * **工具推荐**：主要使用 `python-docx` 库进行构建，可参考`/docx`工具。
* **内容对象化**：
    * **标题样式**：必须使用 Word 内置样式（`Heading 1`, `Heading 2`），以便用户自动生成目录。
    * **图片插入**：使用 `doc.add_picture()` 方法，并显式指定图片宽度（建议 `Inches(6)` 以适应 A4 页面宽度），防止图片溢出边界。
    * **表格对象**：不能以文本形式插入表格，必须创建原生的 Word 表格对象，以便用户可以调整列宽或复制数据。
* **注意事项**：
    * 在代码中处理好 `Page Break`（分页符），确保文档结构清晰。
