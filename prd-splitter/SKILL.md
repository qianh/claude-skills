# PRD 文档拆分助手

## 核心目标 🎯

**帮助开发同学更好地理解产品需求，将 PRD 按可执行任务的颗粒度拆分为独立的 Markdown 文档，方便后续进行技术方案设计。**

### 服务对象

- 前端开发工程师
- 后端开发工程师
- 测试工程师
- 技术负责人

### 核心价值

1. **降低理解成本**：将复杂的 PRD 拆解为独立、可理解的任务单元
2. **明确任务边界**：每个任务文档自包含，开发可独立认领和开发
3. **衔接技术设计**：为每个任务预留技术方案设计区域，便于后续补充
4. **提升协作效率**：清晰的任务划分，减少沟通成本和返工

---

## 拆分原则 ⭐ 核心

### 任务颗粒度标准

**每个拆分出的任务应该满足以下条件**：

| 维度     | 标准                         |
| -------- | ---------------------------- |
| 可执行性 | 一个开发人员可以独立完成     |
| 时间范围 | 预计 0.5-3 天可完成          |
| 独立性   | 可单独进行技术设计和代码评审 |
| 可测试性 | 有明确的验收标准             |

### 拆分层级

```
PRD 文档
  └── 模块 (如：订单管理)
        └── 功能 (如：订单列表)
              └── 任务 ⭐ (如：订单搜索筛选)  ← 这是我们要输出的颗粒度
                    └── 子任务 (如：日期范围选择器)
```

**重要**：如果一个"任务"预计超过 3 天，应继续拆分为更小的子任务。

### 什么算一个独立任务？

**✅ 好的任务拆分示例**：

- 订单列表 - 搜索筛选功能
- 订单详情 - 危险品信息导入按钮
- 用户管理 - 批量导入用户功能

**❌ 拆分过粗的示例**：

- 整个订单模块（太大，无法独立开发）
- 订单管理系统重构（范围不明确）

**❌ 拆分过细的示例**：

- 修改某个按钮的颜色（太小，不值得单独文档）
- 添加一个输入框（除非有复杂校验逻辑）

---

## 触发条件

用户提供 PRD 文档（PDF、Word 等）并希望将其拆分为独立需求文档时使用。典型触发词：

- "拆分 PRD"、"分析 PRD"、"PRD 拆解"
- "把这个需求文档拆分一下"
- "帮我整理这个产品文档"
- "帮开发同学拆解这个需求"

---

## 工作流程

### 第一步：确认输入与目标

1. **获取文档路径**：用户提供的 PRD 文档路径
2. **了解背景**（可选但推荐）：
   - 这个需求的业务背景是什么？
   - 涉及哪些角色（前端/后端/全栈）？
   - 有没有特别关注的模块？
3. **确认输出路径**：默认 `PRD拆分-{文档名}-{YYYYMMDD}/`

### 第二步：PDF 内容提取

> 💡 本技能集成了 pdf skill 和 zai-mcp-server MCP，提供精准的文本、表格和图片提取能力。

#### 2.1 标准 PDF 处理

```python
import pdfplumber

with pdfplumber.open("PRD文档.pdf") as pdf:
    for i, page in enumerate(pdf.pages):
        text = page.extract_text()
        tables = page.extract_tables()
```

#### 2.2 表格提取（字段规格表是关键）

```python
import pdfplumber
import pandas as pd

with pdfplumber.open("PRD文档.pdf") as pdf:
    for page in pdf.pages:
        tables = page.extract_tables()
        for table in tables:
            if table and len(table) > 1:
                df = pd.DataFrame(table[1:], columns=table[0])
                print(df.to_markdown(index=False))
```

#### 2.3 扫描版 PDF / 图片处理

**必须使用 zai-mcp-server 进行二次校验，确保内容准确。**

```
工具: mcp__zai-mcp-server__extract_text_from_screenshot
参数:
  image_source: "page-01.png"
  prompt: "精确提取这个PRD文档页面中的所有文本内容，包括标题、正文、表格内容。保持原有的层级结构。"
```

> ⚠️ **重要**：OCR 结果与 zai-mcp-server 结果有差异时，**以 zai-mcp-server 结果为准**。

#### 2.4 图片提取

```bash
# 提取所有嵌入图片
pdfimages -png "{PRD文件路径}" "assets/img"

# 获取图片页码映射
pdfimages -list "{PRD文件路径}"
```

### 第三步：需求理解与任务识别

**这是最关键的一步，需要深入理解 PRD 内容。**

#### 3.1 识别文档结构

- 版本迭代记录
- 模块划分（一级）
- 功能点（二级）
- 具体需求描述（三级及以下）

#### 3.2 识别可执行任务

从 PRD 中识别出可独立开发的任务单元，每个任务应包含：

| 要素     | 说明                         |
| -------- | ---------------------------- |
| 功能描述 | 这个任务要实现什么功能       |
| 用户场景 | 用户在什么情况下使用         |
| 输入输出 | 功能的输入是什么，输出是什么 |
| 业务规则 | 有哪些业务逻辑和约束         |
| 交互说明 | 用户如何与功能交互           |
| 异常处理 | 异常情况如何处理             |

### 第四步：生成任务文档

**每个任务生成一个独立的 Markdown 文件，内容越详细越好。**

---

## 任务文档模板 📋

```markdown
# {任务标题}

> 📌 本文档用于指导开发实现，包含完整的业务需求说明。技术方案部分待开发人员补充。

## 1. 任务概述

### 1.1 基本信息

| 属性       | 值                              |
| ---------- | ------------------------------- |
| 所属模块   | {模块名}                        |
| 所属功能   | {功能名}                        |
| 任务类型   | 新增功能 / 功能优化 / Bug修复   |
| 优先级     | P0-紧急 / P1-高 / P2-中 / P3-低 |
| 预估工作量 | {X} 人天                        |
| 涉及端     | 前端 / 后端 / 前后端            |

### 1.2 任务描述

{用 2-3 句话清晰描述这个任务要做什么，解决什么问题}

### 1.3 业务背景

{为什么要做这个功能？解决用户什么痛点？}

---

## 2. 需求详情 ⭐

### 2.1 用户故事

**作为** {角色}，
**我想要** {功能描述}，
**以便于** {业务价值}。

### 2.2 功能说明

{详细描述功能的具体表现，包括：}

- 功能入口在哪里
- 触发条件是什么
- 执行什么操作
- 产生什么结果

### 2.3 UI 原型

![原型图](./assets/{图片文件名}.png)

> 图片说明：{描述图片展示的内容和关键交互点}

**界面元素说明**：

| 元素     | 类型                   | 说明       |
| -------- | ---------------------- | ---------- |
| {元素名} | 按钮/输入框/下拉框/... | {功能说明} |

---

## 3. 字段规格 📊

### 3.1 数据字段

| 字段名   | 字段标识    | 类型                   | 必填  | 默认值   | 校验规则   | 说明       |
| -------- | ----------- | ---------------------- | ----- | -------- | ---------- | ---------- |
| {字段名} | {fieldName} | String/Number/Date/... | 是/否 | {默认值} | {校验规则} | {详细说明} |

### 3.2 字段校验规则详解

**{字段名}**：

- 格式要求：{具体格式}
- 长度限制：{最小长度}-{最大长度}
- 特殊字符：{是否允许，哪些允许}
- 错误提示："{具体错误提示文案}"

---

## 4. 业务规则 📜

### 4.1 核心业务逻辑

{详细描述业务计算逻辑、状态流转、权限控制等}

**规则 1**：{规则描述}

- 条件：{触发条件}
- 动作：{执行动作}
- 示例：{具体例子}

**规则 2**：{规则描述}
...

### 4.2 状态流转（如适用）
```

{状态A} --[触发事件]--> {状态B} --[触发事件]--> {状态C}

```

### 4.3 权限控制（如适用）

| 权限码 | 权限名称 | 说明 |
|--------|----------|------|
| `{权限码}` | {权限名称} | {哪些角色拥有，控制什么功能} |

---

## 5. 交互说明 🖱️

### 5.1 正常流程

1. 用户 {操作1}
2. 系统 {响应1}
3. 用户 {操作2}
4. 系统 {响应2}
5. ...

### 5.2 交互细节

| 交互场景 | 用户操作 | 系统响应 | 备注 |
|----------|----------|----------|------|
| {场景1} | {操作} | {响应} | {补充说明} |

### 5.3 加载与反馈

- **加载状态**：{按钮loading / 页面skeleton / ...}
- **成功反馈**：{Toast提示 / 页面跳转 / ...}
- **失败反馈**：{错误提示内容和方式}

---

## 6. 异常处理 ⚠️

### 6.1 异常场景

| 异常场景 | 触发条件 | 处理方式 | 用户提示 |
|----------|----------|----------|----------|
| {场景1} | {条件} | {处理逻辑} | "{提示文案}" |
| {场景2} | {条件} | {处理逻辑} | "{提示文案}" |

### 6.2 边界情况

- **空数据**：{如何展示}
- **数据过多**：{分页/虚拟滚动/...}
- **网络异常**：{重试机制/离线提示}
- **并发冲突**：{乐观锁/悲观锁/提示刷新}

---

## 7. 接口需求 🔌

> ⚠️ **注意**：具体接口规格由后端通过 Swagger 文档提供，此处仅记录 PRD 中明确的接口需求。

### 7.1 需要的接口能力

| 接口用途 | 请求方式 | 说明 | 备注 |
|----------|----------|------|------|
| {用途描述} | GET/POST/PUT/DELETE | {功能说明} | 待后端设计 |

### 7.2 接口数据需求

{描述接口需要返回哪些数据，支持哪些查询条件等}

---

## 8. 验收标准 ✅

### 8.1 功能验收

- [ ] {验收点1：具体可验证的功能表现}
- [ ] {验收点2：具体可验证的功能表现}
- [ ] {验收点3：具体可验证的功能表现}

### 8.2 体验验收

- [ ] 操作响应时间 < {X}ms
- [ ] 错误提示清晰准确
- [ ] 符合设计稿还原度要求

### 8.3 边界验收

- [ ] 空数据状态展示正确
- [ ] 极限数据量下性能正常
- [ ] 网络异常时有友好提示

---

## 9. 关联信息 🔗

### 9.1 前置依赖

- [ ] {依赖任务1}：{简要说明}
- [ ] {依赖任务2}：{简要说明}

### 9.2 影响范围

- {下游任务1}：{影响说明}
- {现有功能}：{影响说明}

### 9.3 相关文档

- [PRD 原文](./README.md)
- [{关联任务}](./{关联任务文件}.md)

---

## 10. 技术方案（待开发补充）📐

> 🔧 **此部分由开发人员在技术评审时补充**

### 10.1 实现方案概述

{开发填写：简述技术实现思路}

### 10.2 前端实现

**涉及文件**：
- `{文件路径1}`：{修改说明}
- `{文件路径2}`：{修改说明}

**组件设计**：
{开发填写}

**状态管理**：
{开发填写}

### 10.3 后端实现

**涉及接口**：
- `{接口路径1}`：{说明}

**数据模型变更**：
{开发填写}

### 10.4 技术风险

| 风险点 | 影响 | 应对措施 |
|--------|------|----------|
| {风险1} | {影响} | {措施} |

### 10.5 测试要点

{开发填写：需要重点测试的场景}

---

## 11. 备注 📝

{PRD 中的其他补充信息、产品经理的备注说明等}
```

---

## 输出目录结构

```
PRD拆分-{文档名}-{YYYYMMDD}/
├── README.md                    # 需求概览、模块清单、依赖关系图
├── 00-需求总览.md               # PRD 原始内容的结构化整理
│
├── 01-{模块A}/                  # 按模块组织
│   ├── 01-{任务1}.md
│   ├── 02-{任务2}.md
│   └── ...
│
├── 02-{模块B}/
│   ├── 01-{任务1}.md
│   └── ...
│
└── assets/                      # 所有图片资源
    ├── img-000.png
    ├── img-001.png
    └── ...
```

### README.md 内容

```markdown
# {PRD 名称} - 需求拆分文档

## 项目信息

- **PRD 来源**：{原文件名}
- **拆分日期**：{YYYY-MM-DD}
- **版本**：{版本号}

## 任务清单

### 模块A：{模块名}

| 序号 | 任务名称                          | 涉及端 | 优先级 | 预估工作量 | 状态   |
| ---- | --------------------------------- | ------ | ------ | ---------- | ------ |
| 1    | [{任务1}](./01-模块A/01-任务1.md) | 前端   | P1     | 2人天      | 待开发 |
| 2    | [{任务2}](./01-模块A/02-任务2.md) | 前后端 | P1     | 3人天      | 待开发 |

### 模块B：{模块名}

| 序号 | 任务名称                          | 涉及端 | 优先级 | 预估工作量 | 状态   |
| ---- | --------------------------------- | ------ | ------ | ---------- | ------ |
| 1    | [{任务1}](./02-模块B/01-任务1.md) | 后端   | P2     | 1人天      | 待开发 |

## 依赖关系

{任务A} --> {任务B} --> {任务C}
↘ {任务D}

## 总工作量估算

| 类型 | 任务数 | 总工作量 |
| ---- | ------ | -------- |
| 前端 | {X} 个 | {Y} 人天 |
| 后端 | {X} 个 | {Y} 人天 |
| 合计 | {X} 个 | {Y} 人天 |
```

---

## 核心原则 ⚠️

### 必须做到

1. ✅ **忠实提取**：只提取 PRD 中明确描述的内容
2. ✅ **详细完整**：每个任务文档应包含开发所需的全部业务信息
3. ✅ **独立自包含**：每个任务文档可独立理解，不需要频繁查阅其他文档
4. ✅ **嵌入原型图**：UI 相关的任务必须包含原型截图
5. ✅ **标注待定项**：不确定的内容标注「待确认」或「待技术设计」

### 绝对禁止

1. ❌ **不要编造**：不要生成 PRD 中没有的文件路径、API 路径、技术方案
2. ❌ **不要猜测**：不确定的内容要明确标注，而不是猜测填充
3. ❌ **不要过度技术化**：技术实现细节留给开发人员决定

---

## 详细程度指南 📏

**核心原则：越详细越好，让开发同学拿到文档就能开始技术设计。**

### 每个任务文档应该详细到什么程度？

| 内容     | 最低要求         | 推荐做法                             |
| -------- | ---------------- | ------------------------------------ |
| 功能描述 | 2-3 句话说明     | 包含用户故事、业务背景、功能价值     |
| 字段说明 | 列出字段名和类型 | 包含校验规则、错误提示、边界值       |
| 交互说明 | 描述主流程       | 包含所有异常流程、加载状态、反馈方式 |
| 业务规则 | 列出主要规则     | 包含条件、动作、具体示例             |
| 异常处理 | 列出常见异常     | 包含所有边界情况和处理方式           |

### 示例：详细 vs 简略

**❌ 简略（不够详细）**：

> 用户可以导入危险品信息

**✅ 详细（推荐）**：

> **功能描述**：在订舱详情页面的危险品信息区域，新增"导入"按钮，支持用户通过 Excel 文件批量导入危险品信息。
>
> **文件格式**：.xlsx/.xls，文件大小限制 10MB
>
> **模板要求**：需提供下载模板功能，模板包含以下列：UN编号、品名、类别、包装类型、数量...
>
> **导入流程**：点击导入 → 选择文件 → 解析校验 → 预览数据 → 确认导入
>
> **校验规则**：
>
> - UN编号：必填，4位数字
> - 品名：必填，最大100字符
> - 数量：必填，正整数
>
> **错误处理**：
>
> - 文件格式错误：提示"仅支持Excel文件格式"
> - 数据校验失败：显示错误行号和具体错误原因，支持导出错误报告

---

## PDF 处理工具参考

### Python 库

| 任务     | 推荐工具                | 说明                    |
| -------- | ----------------------- | ----------------------- |
| 文本提取 | pdfplumber              | 保留布局，支持坐标      |
| 表格提取 | pdfplumber              | `page.extract_tables()` |
| 页面渲染 | pypdfium2               | 高质量图片输出          |
| 基本操作 | pypdf                   | 合并、拆分、元数据      |
| OCR 识别 | pytesseract + pdf2image | 扫描件处理              |

### 命令行工具

| 任务     | 命令            | 示例                                     |
| -------- | --------------- | ---------------------------------------- |
| 提取文本 | pdftotext       | `pdftotext -layout input.pdf output.txt` |
| 提取图片 | pdfimages       | `pdfimages -png input.pdf prefix`        |
| 图片列表 | pdfimages -list | `pdfimages -list input.pdf`              |
| 页面转图 | pdftoppm        | `pdftoppm -png -r 300 input.pdf output`  |

### zai-mcp-server 工具

| 场景     | 工具                           | 用途                       |
| -------- | ------------------------------ | -------------------------- |
| 文本提取 | `extract_text_from_screenshot` | OCR 二次校验，以此结果为准 |
| 表格分析 | `analyze_image`                | 结构化表格提取             |
| UI 分析  | `analyze_image`                | 原型图元素识别             |
| 图表理解 | `analyze_data_visualization`   | 数据图表解读               |
| 流程图   | `understand_technical_diagram` | 业务流程图解析             |

**调用优先级**：

1. 先用 pdfplumber/pytesseract 进行初次提取
2. 对于扫描版/图片 PDF，**必须**使用 zai-mcp-server 二次校验
3. 差异时，**始终采用 zai-mcp-server 结果**

---

## 故障排除

### PDF 文本提取为空或乱码

**解决方案**：使用 zai-mcp-server 进行 AI 视觉识别

```
工具: mcp__zai-mcp-server__extract_text_from_screenshot
参数:
  image_source: "page-1.png"
  prompt: "精确提取图片中的所有中英文文本，保持原有格式和层级结构"
```

### 表格结构识别错误

**解决方案**：使用 zai-mcp-server 的 analyze_image 进行视觉分析

```
工具: mcp__zai-mcp-server__analyze_image
参数:
  image_source: "page-with-table.png"
  prompt: "识别表格结构，提取所有列标题和数据，输出为 Markdown 表格格式"
```

### UI 原型图文字提取困难

**解决方案**：使用 zai-mcp-server 专门分析 UI 元素

```
工具: mcp__zai-mcp-server__analyze_image
参数:
  image_source: "ui-prototype.png"
  prompt: "分析这个 UI 原型图，提取所有可见文本：页面标题、按钮文字、表单标签、表格列标题、提示信息等"
```

---

## 最终检查清单 ✔️

在完成拆分后，确保：

- [ ] 每个任务的颗粒度合适（0.5-3 天工作量）
- [ ] 每个任务文档内容完整详细
- [ ] 所有 UI 相关任务都嵌入了原型截图
- [ ] 字段规格表包含校验规则和错误提示
- [ ] 业务规则描述清晰，有具体示例
- [ ] 异常处理场景覆盖完整
- [ ] 验收标准具体可验证
- [ ] 技术方案区域已预留，待开发补充
- [ ] README.md 包含完整的任务清单和依赖关系
