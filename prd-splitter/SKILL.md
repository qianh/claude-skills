# PRD 文档拆分助手

将产品 PRD 文档按需求-任务维度拆分为独立的 Markdown 文件，**仅提取 PRD 中明确描述的内容，不生成任何推测性技术细节**。

## 触发条件

用户提供 PRD 文档（PDF、Word 等）并希望将其拆分为独立需求文档时使用。典型触发词：

- "拆分 PRD"、"分析 PRD"、"PRD 拆解"
- "把这个需求文档拆分一下"
- "帮我整理这个产品文档"

## 核心原则 ⚠️

**绝对禁止生成以下内容**：

1. ❌ 文件路径（如 `src/pages/xxx.tsx`）- 除非 PRD 明确指定
2. ❌ API 接口路径（如 `POST /api/xxx`）- 除非 PRD 明确指定
3. ❌ 请求/响应参数格式 - 除非 PRD 明确指定
4. ❌ 技术实现方案 - 除非 PRD 明确指定
5. ❌ 组件名称、服务名称 - 除非 PRD 明确指定

**应该做的是**：

1. ✅ 忠实提取 PRD 中的功能描述
2. ✅ 保留 PRD 中的字段规格、校验规则
3. ✅ 保留 PRD 中明确提到的权限码
4. ✅ 保留 PRD 中的业务逻辑说明
5. ✅ 提取并嵌入 PRD 中的截图/原型图
6. ✅ 对于需要技术设计的部分，标注「待技术设计」

## 工作流程

### 第一步：确认输入

1. **获取文档路径**：用户提供的 PRD 文档路径
2. **确认范围**：
   - 用户指定模块 → 仅分析该模块
   - 用户未指定 → 全文档分析
3. **确认输出路径**：默认在当前目录创建 `PRD拆分-{文档名}-{YYYYMMDD}/` 文件夹
   - 文档名：取 PRD 文件名（去掉扩展名）
   - 日期：拆分当天的日期，格式 YYYYMMDD
   - 示例：`PRD拆分-紧急需求迭代内容-20260119/`

### 第二步：文档分析与图片提取

使用 Read 工具读取文档，识别以下结构：

**文档层级识别**：

- 版本迭代记录（如有）
- 模块划分（一级标题）
- 功能点（二级标题）
- 具体需求（三级及以下标题）

**内容元素识别**：

- 需求描述文本
- 字段规格表格
- UI 截图/原型图 ⭐
- 业务规则/逻辑说明
- 接口定义（API）- 仅当 PRD 明确定义时
- 权限配置

**图片提取流程（必须执行）** ⭐：

1. **创建 assets 目录**：

   ```bash
   mkdir -p "PRD拆分-{文档名}-{YYYYMMDD}/assets"
   ```

2. **获取图片页码映射**：

   ```bash
   pdfimages -list "{PRD文件路径}" 2>/dev/null | awk 'NR>2 {print $1, $2}'
   ```

   这会输出每张图片所在的页码和图片序号，格式为 `页码 图片序号`

3. **提取所有图片**：

   ```bash
   pdfimages -png "{PRD文件路径}" "PRD拆分-{文档名}-{YYYYMMDD}/assets/img"
   ```

   这会生成 `img-000.png`, `img-001.png` 等图片文件

4. **建立图片与功能模块的映射关系**：
   - 根据 pdfimages 输出的页码信息，确定每张图片属于哪个功能模块
   - 参照文本内容中的页码标识（如 `1 / 71`、`2 / 71`）匹配图片
   - 记录映射关系：`图片文件名 -> 功能模块名`

5. **图片映射示例**：
   如果 pdfimages 输出显示：
   ```
   10 12    # 第10页的图片对应 img-012.png
   14 13    # 第14页的图片对应 img-013.png
   ```
   而第10-14页的内容是"危险品导入"，则 img-012.png 和 img-013.png 应嵌入到 `01-危险品信息导入.md`

### 第三步：需求拆分

**拆分原则**：

1. 每个独立功能点拆分为一个 md 文件
2. 保持需求的完整性和自包含性
3. 文件命名：`{序号}-{功能名称}.md`
4. **只提取 PRD 原文内容，不添加任何推测**

**单个需求文件结构**：

```markdown
# {需求标题}

## 基本信息

- **所属模块**：{模块名}
- **版本**：{版本号}
- **优先级**：{如有}

## 需求描述

{PRD 原文中的需求说明，保持原文表述}

## UI 原型 ⭐

![界面原型](./assets/{图片文件名}.png)

> 图片说明：{描述图片展示的内容}

## 功能规格

### 字段说明

{仅当 PRD 中有明确的字段定义时才填写}

| 字段名        | 字段类型      | 是否必填  | 校验规则      | 默认值    | 说明          |
| ------------- | ------------- | --------- | ------------- | --------- | ------------- |
| {PRD原文字段} | {PRD原文类型} | {PRD原文} | {PRD原文规则} | {PRD原文} | {PRD原文说明} |

### 业务逻辑

{PRD 原文中的业务规则、计算逻辑、状态流转等}

### 交互说明

{PRD 原文中的交互描述}

---

## 开发任务清单

### 前端任务

{根据 PRD 描述的功能点，列出需要开发的前端任务}

#### FE-001: {功能描述}

- **任务类型**: 新增/修改
- **功能说明**: {PRD 中描述的功能要求}
- **涉及页面**: {PRD 中提到的页面名称，如"订舱详情页面"}
- **UI交互**: {PRD 中描述的交互行为}
- **技术实现**: 待技术设计 ⚠️
- **验收标准**:
  - [ ] {根据 PRD 功能点转化的验收条件}

---

## 后端接口

> ⚠️ **注意**：后端接口规格将通过 Swagger 文档单独提供，此处仅记录 PRD 中明确提到的接口需求。

{如 PRD 中提到了接口相关内容，在此记录；否则写"待后端提供 Swagger 文档"}

---

## 权限要求

{仅当 PRD 明确指定权限码时填写}

- **功能权限码**: `{PRD原文权限码}`
- **说明**: {PRD原文说明}

## 关联需求

- 前置依赖：{PRD 中提到的依赖}
- 后续影响：{PRD 中提到的影响}

## 测试要点

{根据 PRD 功能描述转化的测试场景}

### 正常场景

1. {PRD 描述的正常使用场景}

### 边界场景

1. {PRD 描述的异常或边界情况}

## 备注

{PRD 中的其他补充信息}
```

### 第四步：处理关联关系

1. **识别跨需求依赖**：
   - 数据依赖（A 需求的数据被 B 使用）
   - 流程依赖（A 完成后才能进行 B）
   - 接口依赖（共用接口或调用关系）

2. **标注方式**：
   - 在每个需求文件的"关联需求"部分明确标注
   - 使用相对链接：`[需求名](./01-xxx.md)`

### 第五步：生成输出

1. 创建输出目录结构：

```
PRD拆分-{文档名}-{YYYYMMDD}/
├── README.md              # 需求概览和目录
├── 01-{功能A}.md
├── 02-{功能B}.md
├── ...
└── assets/                # 截图和附件 ⭐
    ├── 01-功能A-prototype.png
    └── ...
```

示例：`PRD拆分-紧急需求迭代内容-20260119/`

2. 生成 README.md 包含：
   - 项目概述
   - 版本信息
   - 需求清单（带链接）
   - 依赖关系图（文本形式）

## 注意事项

1. **严禁伪造数据** ⚠️：
   - 不要编造文件路径、API路径、参数格式
   - 不要推测技术实现方案
   - 不确定的内容标注「待技术设计」或「待确认」
   - 只提取 PRD 原文中明确描述的内容

2. **图片处理（核心步骤）** ⭐：

   **提取步骤**：
   - 使用 `pdfimages -png` 命令从 PDF 提取所有图片到 `assets/` 目录
   - 使用 `pdfimages -list` 命令获取图片与页码的对应关系

   **嵌入步骤（生成每个 md 文件时必须执行）**：
   - 根据当前功能模块在 PRD 中的页码范围，找到对应的图片文件
   - 在 md 文件的 `## 需求描述` 后立即添加 `## UI 原型` 章节
   - 使用 `![描述](./assets/img-xxx.png)` 语法嵌入图片
   - 在图片下方添加 `> 图片说明：{描述图片展示的内容}`

   **图片嵌入示例**：

   ```markdown
   ## UI 原型

   ### 页面截图

   ![功能名称-页面截图](./assets/img-012.png)

   > 图片说明：订舱详情页面危险品信息导入按钮位置
   ```

   **检查清单**：
   - [ ] 每个有 UI 界面的需求文档都包含 `## UI 原型` 章节
   - [ ] 图片路径使用相对路径 `./assets/xxx.png`
   - [ ] 图片有描述性的 alt 文本
   - [ ] 每张图片下方有说明文字

3. **任务拆分原则**：
   - 前端/后端任务只描述「做什么」，不描述「怎么做」
   - 技术实现细节留给开发人员决定
   - 验收标准基于 PRD 功能描述，而非技术方案

4. **表格转换**：将文档中的表格转换为 Markdown 表格格式

5. **编号保持**：保留原文档的章节编号以便追溯

6. **完整性检查**：
   - 拆分后确保每个需求文件可独立理解
   - 确保图片正确显示
   - 确保没有添加 PRD 中不存在的内容

7. **中文友好**：文件名使用中文，确保可读性

## 任务编号规范

- **FE-xxx**：前端开发任务
- 编号在单个需求文件内从 001 开始递增

## 「待技术设计」标注示例

当 PRD 没有明确技术细节时，应该这样标注：

```markdown
#### FE-001: 危险品信息导入按钮

- **任务类型**: 新增功能
- **功能说明**: 在危险品信息区域增加"导入"按钮，支持 Excel 格式导入
- **涉及页面**: 订舱详情页面、提单详情页面
- **UI交互**:
  - 点击按钮后弹出文件选择框
  - 导入成功后刷新危险品列表
  - 导入失败显示错误信息
- **技术实现**: 待技术设计 ⚠️
- **验收标准**:
  - [ ] 按钮位置正确
  - [ ] 支持 Excel 格式导入
  - [ ] 导入失败时显示错误提示
```
